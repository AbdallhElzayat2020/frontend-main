import axios from "axios";
import { useParams } from "react-router-dom";
import Breadcrumb from "../../../components/Breadcrumb";
import {
  Tabs,
  TabsContent,
  TabsList,
  TabsTrigger,
} from "../../../components/ui/tabs";
import { useNavigate } from "react-router-dom";

import TaskHistory from "./TaskHistory";
import Information from "./Information";
import ScheduledSimulations from "./ScheduledSimulations";

import { useEffect, useState } from "react";

export default function AgentInfo() {
  const params = useParams();
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<any>({});

  const getData = async () => {
    setLoading(true);
    try {
      await axios.get(`/agents/${params.id}`).then((res) => {
        setData(res.data);
      });
      // !!!!!!!!!!! TO BE REMOVED !!!!!!!!!!!
      setTimeout(() => {
        setLoading(false);
      }, 500);
    } catch (e) {
      navigate(`/agents`);
      setLoading(false);
      console.log(e);
    }
  };
  useEffect(() => {
    getData();
  }, []);

  return (
    <div>
      <div className="mb-6 flex-col space-y-2 border-b border-stroke pb-4 sm:flex-row sm:items-center sm:justify-between dark:border-strokedark">
        <h2 className="text-lg font-medium text-black dark:text-white">
          <span
            onClick={() => navigate(`/agents`)}
            className="cursor-pointer hover:underline"
          >
            Agents
          </span>{" "}
          <span className="text-gray-400"> / </span>{" "}
          <span>{data?.Information?.HostName}</span>
        </h2>
        <div className="flex items-center gap-1">
          {data?.Information?.OS == "Windows" ? (
            <span className="flex w-fit items-center gap-1 bg-primary/10 px-1 font-medium text-primary">
              <svg
                width="17"
                height="19"
                viewBox="0 0 17 19"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_1670_11556)">
                  <path
                    d="M0 3.45924L6.77742 2.52531V9.07387H0V3.45924ZM0 15.4415L6.77742 16.3755V9.90812H0V15.4415ZM7.52309 16.4751L16.5375 17.7191V9.90812H7.52309V16.4751ZM7.52309 2.42564V9.07387H16.5375V1.18164L7.52309 2.42564Z"
                    fill="#743A8E"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_1670_11556">
                    <rect width="16.5375" height="18.9" fill="white" />
                  </clipPath>
                </defs>
              </svg>
              Windows
            </span>
          ) : data?.Information?.OS == "Mac" ? (
            <span className="flex w-fit items-center gap-1 bg-primary/10 px-1 font-medium text-primary">
              <svg
                width="20"
                height="19"
                viewBox="0 0 20 19"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M14.7056 9.9192C14.6978 8.56445 15.3462 7.54193 16.6587 6.78889C15.9243 5.7959 14.8149 5.24957 13.3501 5.14252C11.9634 5.03916 10.4478 5.90664 9.89307 5.90664C9.30713 5.90664 7.96338 5.17943 6.90869 5.17943C4.729 5.21266 2.4126 6.82211 2.4126 10.0964C2.4126 11.0635 2.6001 12.0627 2.9751 13.0938C3.4751 14.4486 5.27978 17.7708 7.1626 17.7154C8.14697 17.6933 8.84228 17.0547 10.1235 17.0547C11.3657 17.0547 12.0103 17.7154 13.1079 17.7154C15.0063 17.6896 16.6392 14.67 17.1157 13.3116C14.5688 12.1783 14.7056 9.98934 14.7056 9.9192ZM12.4946 3.85791C13.561 2.66189 13.4634 1.57293 13.4321 1.18164C12.4907 1.23332 11.4009 1.78703 10.7798 2.46994C10.0962 3.20084 9.69385 4.10523 9.77978 5.12406C10.7993 5.19789 11.729 4.70324 12.4946 3.85791Z"
                  fill="#743A8E"
                />
              </svg>
              Mac
            </span>
          ) : data?.Information?.OS == "Linux" ? (
            <span className="flex w-fit items-center gap-1 bg-primary/10 px-1 font-medium text-primary">
              <svg
                width="20"
                height="19"
                viewBox="0 0 20 19"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M17.1232 15.1751C16.5689 14.9481 16.3319 14.6469 16.3548 14.1975C16.3784 13.6728 16.0808 13.2886 15.9394 13.1368C16.0248 12.8106 16.2744 11.6821 15.9397 10.702C15.58 9.65288 14.4819 8.05059 13.3489 6.47555C12.8851 5.82874 12.8632 5.12565 12.8378 4.31152C12.8135 3.53501 12.7861 2.65482 12.3531 1.67635C11.8823 0.610939 10.9375 0 9.76093 0C9.06101 0 8.34256 0.218746 7.78968 0.600094C6.65753 1.38144 6.80718 3.085 6.90621 4.21225C6.91978 4.36661 6.93255 4.51242 6.93998 4.63691C7.00592 5.74093 6.94593 6.3228 6.86748 6.49966C6.81673 6.61523 6.56687 6.94415 6.30246 7.29241C6.029 7.65257 5.71897 8.06081 5.46484 8.44123C5.16163 8.89898 4.91686 9.59866 4.68015 10.2753C4.50695 10.7704 4.34335 11.2381 4.1841 11.5176C3.88225 12.0552 3.95736 12.5565 4.02007 12.7882C3.9058 12.8676 3.74072 13.0239 3.60135 13.3185C3.43292 13.6779 3.09117 13.871 2.38053 14.0077C2.05396 14.0745 1.82877 14.2118 1.71103 14.4158C1.53969 14.7127 1.63301 15.0857 1.71816 15.3406C1.84395 15.7154 1.76556 15.9526 1.62304 16.3833C1.59019 16.4827 1.55295 16.5952 1.51521 16.7194C1.45579 16.9152 1.47723 17.0933 1.57879 17.2487C1.84717 17.659 2.63032 17.8037 3.43652 17.8989C3.91788 17.956 4.44473 18.1485 4.95429 18.3348C5.45356 18.5172 5.96982 18.7059 6.4391 18.7632C6.51042 18.7722 6.58107 18.7767 6.64917 18.7767C7.35771 18.7767 7.67783 18.3065 7.77933 18.1134C8.03383 18.0615 8.91161 17.8951 9.81627 17.8728C10.7195 17.847 11.5934 18.0254 11.841 18.0809C11.9188 18.2298 12.124 18.5701 12.4511 18.7454C12.6308 18.8437 12.881 18.9 13.1372 18.9H13.1373C13.411 18.9 13.9315 18.8353 14.3436 18.4018C14.7545 17.9663 15.7813 17.4104 16.5311 17.0044C16.6985 16.9138 16.855 16.829 16.9922 16.7525C17.4134 16.519 17.6433 16.1854 17.6228 15.8372C17.6057 15.548 17.4142 15.2943 17.1232 15.1751ZM7.79891 15.0913C7.74649 14.722 7.27138 14.3557 6.72117 13.9316C6.27129 13.5847 5.76136 13.1917 5.62088 12.8588C5.33056 12.1721 5.5594 10.9646 5.95841 10.3428C6.1556 10.0314 6.31665 9.55931 6.47244 9.10273C6.64062 8.60972 6.81456 8.09997 7.00908 7.87683C7.31712 7.52845 7.6018 6.85058 7.65224 6.31636C7.9407 6.59174 8.38817 6.94118 8.80155 6.94118C8.86519 6.94118 8.92697 6.93288 8.98603 6.91621C9.26885 6.83453 9.68484 6.59416 10.0871 6.36178C10.434 6.16138 10.8617 5.91425 11.0226 5.89176C11.2985 6.28798 12.9019 9.83631 13.0658 10.9758C13.1954 11.8775 13.0585 12.6228 12.9896 12.9147C12.9342 12.9072 12.8682 12.901 12.7988 12.901C12.3522 12.901 12.2339 13.1448 12.2031 13.2904C12.1239 13.6686 12.1156 14.8779 12.1147 15.1496C11.9532 15.3548 11.1366 16.321 9.96406 16.4947C9.48648 16.5641 9.0405 16.5993 8.63858 16.5993C8.29503 16.5993 8.07579 16.5727 7.98476 16.5589L7.39557 15.8848C7.62788 15.7701 7.86014 15.528 7.79891 15.0913ZM8.54655 3.97516C8.52815 3.98309 8.51006 3.99158 8.49227 4.00063C8.49047 3.96072 8.48632 3.92026 8.47994 3.87967C8.41562 3.50941 8.1701 3.24066 7.89627 3.24066C7.876 3.24066 7.85561 3.24221 7.83324 3.24562C7.67033 3.27276 7.54255 3.39514 7.47253 3.56865C7.53394 3.18792 7.74965 2.90603 8.00558 2.90603C8.30612 2.90603 8.56 3.31105 8.56 3.79044C8.56 3.85085 8.5556 3.91096 8.54655 3.97516ZM10.8819 4.26065C10.9094 4.17302 10.9243 4.07821 10.9243 3.97981C10.9243 3.54517 10.6485 3.20466 10.2965 3.20466C9.95241 3.20466 9.67251 3.55236 9.67251 3.97981C9.67251 4.00893 9.67393 4.03812 9.67666 4.06725C9.65844 4.06024 9.64065 4.05343 9.6233 4.04686C9.58371 3.92695 9.56369 3.80184 9.56369 3.67412C9.56369 3.1544 9.89584 2.73153 10.3042 2.73153C10.7125 2.73153 11.0447 3.1544 11.0447 3.67412C11.0447 3.89033 10.985 4.09668 10.8819 4.26065ZM10.5808 5.27221C10.5749 5.29848 10.5624 5.31013 10.4239 5.38214C10.354 5.41851 10.267 5.46381 10.1581 5.53011L10.0854 5.57417C9.79303 5.7514 9.10848 6.16652 8.92264 6.19088C8.79641 6.20785 8.71833 6.1589 8.54277 6.03961C8.50318 6.01266 8.46104 5.98403 8.41611 5.95521C8.09964 5.74756 7.89608 5.51884 7.87309 5.42942C7.97627 5.34966 8.23201 5.15007 8.36294 5.0319C8.62872 4.78477 8.89618 4.61869 9.02854 4.61869C9.03554 4.61869 9.04186 4.61919 9.04843 4.62043C9.20397 4.64788 9.58761 4.801 9.86783 4.91279C9.99734 4.96447 10.1092 5.00909 10.1879 5.03735C10.4358 5.12249 10.5651 5.23143 10.5808 5.27221ZM12.8083 16.8211C12.9482 16.1902 13.1093 15.332 13.0832 14.826C13.0772 14.7111 13.067 14.5859 13.0572 14.465C13.0388 14.2388 13.0114 13.9026 13.0396 13.8029C13.0452 13.8003 13.0514 13.7981 13.0583 13.7962C13.0595 14.0854 13.1223 14.6624 13.5837 14.8636C13.7212 14.9236 13.8784 14.954 14.0508 14.954C14.513 14.954 15.0258 14.7272 15.2359 14.5172C15.3596 14.3935 15.4636 14.2421 15.5365 14.1223C15.5524 14.169 15.5622 14.2299 15.5571 14.3085C15.5296 14.7352 15.737 15.3012 16.1316 15.5098L16.189 15.5399C16.3296 15.6137 16.7029 15.8097 16.7089 15.9026C16.7089 15.9026 16.7057 15.9136 16.6849 15.9329C16.5914 16.0184 16.2623 16.1864 15.944 16.349C15.3794 16.6373 14.7395 16.964 14.4521 17.2663C14.0474 17.6921 13.5897 17.9782 13.3134 17.9782C13.2801 17.9782 13.2498 17.974 13.2228 17.9654C12.9226 17.8718 12.6756 17.4387 12.8083 16.8211ZM2.57678 15.2116C2.54617 15.0684 2.522 14.9553 2.54796 14.8457C2.5668 14.7645 2.96755 14.6775 3.1387 14.6404C3.37932 14.5882 3.62818 14.5342 3.79091 14.4354C4.01096 14.3021 4.13012 14.0563 4.23522 13.8394C4.31132 13.6826 4.38989 13.5204 4.4834 13.4672C4.48867 13.4641 4.49672 13.4605 4.51209 13.4605C4.68727 13.4605 5.05486 13.8288 5.26667 14.1584C5.3204 14.2415 5.41992 14.408 5.53505 14.6007C5.87941 15.1769 6.35092 15.9661 6.59718 16.2306C6.81908 16.4683 7.17831 16.9255 7.08994 17.3175C7.02525 17.6217 6.68083 17.8691 6.59959 17.9238C6.5701 17.9305 6.5336 17.9339 6.49065 17.9339C6.01933 17.9339 5.08634 17.5418 4.58509 17.3311L4.51091 17.2999C4.231 17.1826 3.77406 17.1086 3.33216 17.0371C2.98056 16.9802 2.49907 16.9023 2.41926 16.8319C2.35456 16.7593 2.42961 16.5234 2.49579 16.3153C2.54344 16.1657 2.59264 16.011 2.6196 15.8491C2.65783 15.5908 2.61284 15.3806 2.57678 15.2116Z"
                  fill="#743A8E"
                />
              </svg>
              Linux
            </span>
          ) : (
            ""
          )}
          -{" "}
          {data?.Information?.AgentStatus == "Connected" ? (
            <span className="flex w-fit items-center gap-1 rounded-full bg-green-600/10 px-3 font-medium text-green-600">
              Connected
            </span>
          ) : data?.Information?.AgentStatus == "Disconnected" ? (
            <span className="flex w-fit items-center gap-1 rounded-full bg-red-500/10 px-3 font-medium text-red-500">
              Disconnected
            </span>
          ) : data?.Information?.AgentStatus == "Stage" ? (
            <span className="flex w-fit items-center gap-1 rounded-full bg-orange-600/10 px-3 font-medium text-orange-600">
              Stage
            </span>
          ) : (
            ""
          )}
          -
          <span className="font-medium">
            Last Connected:{" "}
            <span className="text-gray-900">
              {data?.Information?.LastContact}
            </span>
          </span>
        </div>
      </div>

      {loading ? (
        <div className="space-y-2">
          <div className="h-12 w-64 animate-pulse rounded bg-[#E3E8EF]"></div>
          <div className="h-80 w-full animate-pulse rounded bg-[#E3E8EF]"></div>
        </div>
      ) : (
        <Tabs defaultValue="info" className="w-full">
          <TabsList className="w-fit">
            <TabsTrigger value="info">Information</TabsTrigger>
            <TabsTrigger value="sh">Simulations History</TabsTrigger>
            <TabsTrigger value="ss">Scheduled Simulations</TabsTrigger>
          </TabsList>
          <TabsContent value="info">
            <Information data={data?.Information} />
          </TabsContent>
          <TabsContent value="sh">
            <TaskHistory data={data?.SimulationsHistory} />
          </TabsContent>
          <TabsContent value="ss">
            <ScheduledSimulations data={data?.ScheduledSimulations} />
          </TabsContent>
        </Tabs>
      )}
    </div>
  );
}
